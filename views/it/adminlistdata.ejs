<div class="container-fluid mt-4">
  <!-- ðŸ”¹ Loading Skeleton -->
  <div id="loadingskeleton" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Memuat data, mohon tunggu...</p>
  </div>
  <div id="showmainpage" style="display:none;">
    <h1 class="mb-4">CRUD ADMIN LIST DATA</h1>
    <!-- ðŸ”¹ Grid Summary Cards -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 mb-4" id="summaryGrid">
      <div class="col">
        <div class="card border-primary text-primary text-center shadow-sm h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <i class="bi bi-box-seam display-6"></i>
            <h6 class="mt-2 mb-0">Total Item</h6>
            <h4 class="fw-bold mb-0" id="totalItem">0</h4>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card border-warning text-warning text-center shadow-sm h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <i class="bi bi-hourglass-split display-6"></i>
            <h6 class="mt-2 mb-0">Proses</h6>
            <h4 class="fw-bold mb-0" id="itemProses">0</h4>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card border-success text-success text-center shadow-sm h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <i class="bi bi-check-circle display-6"></i>
            <h6 class="mt-2 mb-0">Selesai</h6>
            <h4 class="fw-bold mb-0" id="itemSelesai">0</h4>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card border-danger text-danger text-center shadow-sm h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <i class="bi bi-exclamation-circle display-6"></i>
            <h6 class="mt-2 mb-0">Tertunda</h6>
            <h4 class="fw-bold mb-0" id="itemTertunda">0</h4>
          </div>
        </div>
      </div>
    </div>
    <div class="table-container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>Data List</h5>
        <input type="text" id="searchInput" class="form-control" style="width: 250px" placeholder="Cari Data ..." />
      </div>

      <div class="d-flex flex-column">
        <div class="d-flex flex-column flex-column gap-3" id="alldattab"></div>
        <div id="datatidakditemukan" style="display: none;">
          <p style="text-align: center;">Data tidak ditemukan</p>
        </div>
      </div>

      <nav class="mt-3">
        <ul class="pagination justify-content-center" id="pagination"></ul>
      </nav>

    </div>
  </div>
</div>

<!-- =======================
ðŸ“ Modal Edit Detail (Full) - WITH TABS, FLAGS, IMAGES, EXTRACHARGE, HISTORY
======================= -->
<div class="modal fade" id="modalEditDetail" tabindex="-1" aria-labelledby="modalEditDetailLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title fw-semibold" id="modalEditDetailLabel">
          <i class="bi bi-pencil-square me-2 text-primary"></i> Edit Detail Transaksi
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body small">
        <!-- Nav Tabs -->
        <ul class="nav nav-tabs" id="editDetailTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-main-btn" data-bs-toggle="tab" data-bs-target="#tab-main"
              type="button" role="tab">Detail Utama</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-flags-btn" data-bs-toggle="tab" data-bs-target="#tab-flags" type="button"
              role="tab">Flag & Sistem</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-prod-btn" data-bs-toggle="tab" data-bs-target="#tab-prod" type="button"
              role="tab">Produksi & Gambar</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-extra-btn" data-bs-toggle="tab" data-bs-target="#tab-extra" type="button"
              role="tab">Extra Charge</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-history-btn" data-bs-toggle="tab" data-bs-target="#tab-history"
              type="button" role="tab">History</button>
          </li>
        </ul>

        <div class="tab-content mt-3" id="editDetailTabsContent">
          <!-- ===== TAB MAIN ===== -->
          <div class="tab-pane fade show active" id="tab-main" role="tabpanel">
            <form id="formEditDetail" class="row g-3">
              <!-- image -->
              <div class="col-12 text-center">
                <img id="editImage" src="" alt="Produk" class="img-fluid rounded shadow-sm mb-2"
                  style="max-height:220px; object-fit:cover;">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">ID Transaksi</label>
                <input type="text" class="form-control" id="editIdTransaksi" readonly disabled />
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">No Transaksi</label>
                <input type="text" class="form-control" id="editNoTransaksi" readonly disabled />
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Order Date</label>
                <input type="text" class="form-control" id="editOrderDate" readonly disabled />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Item</label>
                <input type="text" class="form-control" id="editItem" />
              </div>
              <div class="col-md-2">
                <label class="form-label fw-semibold">Qty</label>
                <input type="number" class="form-control" id="editQty" min="1" />
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Varian</label>
                <input type="text" class="form-control" id="editColorVariant" />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Buyer Name</label>
                <input type="text" class="form-control" id="editBuyerName" />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Phone Number</label>
                <input type="text" class="form-control" id="editPhoneNumber" />
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Address</label>
                <textarea class="form-control" id="editAddress" rows="2"></textarea>
              </div>

              <div class="col-md-3">
                <label class="form-label fw-semibold">Price</label>
                <input type="number" class="form-control" id="editPrice" readonly disabled />
              </div>
              <div class="col-md-3">
                <label class="form-label fw-semibold">Final Price</label>
                <input type="number" class="form-control" id="editFinalPrice" readonly disabled />
              </div>
              <div class="col-md-3">
                <label class="form-label fw-semibold">Diskon %</label>
                <input type="text" class="form-control" id="editDiskonPersen" readonly disabled />
              </div>
              <div class="col-md-3">
                <label class="form-label fw-semibold">Diskon (Rp)</label>
                <input type="number" class="form-control" id="editDiskonAmount" readonly disabled />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Status</label>
                <select class="form-select" id="editStatus">
                  <option value="">-- Pilih Status --</option>
                  <option value="Print PO-DO">Print PO-DO</option>
                  <option value="Pengiriman Bahan">Pengiriman Bahan</option>
                  <option value="Proses Produksi">Proses Produksi</option>
                  <option value="Selesai Produksi">Selesai Produksi</option>
                  <option value="Proses QC dan Packing">Proses QC dan Packing</option>
                  <option value="Standby Pengiriman">Standby Pengiriman</option>
                  <option value="Dalam Pengiriman">Dalam Pengiriman</option>
                  <option value="Selesai">Selesai</option>
                  <option value="Pending">Pending</option>
                  <option value="Reschedule">Reschedule</option>
                  <option value="Dibatalkan">Dibatalkan</option>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Platform</label>
                <input type="text" class="form-control" id="editPlatform" />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Delivered Date</label>
                <input type="date" class="form-control" id="editDeliveredDatePicker" />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Delivery Unit</label>
                <input type="text" class="form-control" id="editDeliveryUnit" />
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Notes</label>
                <textarea class="form-control" id="editNotes" rows="2"></textarea>
              </div>
            </form>
          </div>

          <!-- ===== TAB FLAGS ===== -->
          <div class="tab-pane fade" id="tab-flags" role="tabpanel">
            <div class="row g-3">
              <!-- ðŸŸ¢ FLAG CHECKBOXES -->
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_forcedsent">
                  <label class="form-check-label">forcedsent</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_forcedcancel">
                  <label class="form-check-label">forcedcancel</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_reschedule">
                  <label class="form-check-label">reschedule</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_delayproduksi">
                  <label class="form-check-label">delayproduksi</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_toppriority">
                  <label class="form-check-label">toppriority</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_pending">
                  <label class="form-check-label">pending</label>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">confirmroute</label>
                <input type="text" class="form-control" id="editConfirmRoute" />
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">statusxo</label>
                <input type="text" class="form-control" id="editStatusXO" />
              </div>

              <hr class="my-3">

              <!-- ðŸ§© PRODUKSI DAN GAMBAR STATUS -->
              <div class="col-12">
                <h6 class="fw-semibold border-bottom pb-1 mb-3">
                  <i class="bi bi-image me-2 text-primary"></i> Status Produksi & Gambar
                </h6>
              </div>

              <!-- ðŸ”¹ Print PO/DO -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="flag_print_podo">
                  <label class="form-check-label fw-semibold">print_podo</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="flag_klik_print_podo">
                  <label class="form-check-label fw-semibold">klik_print_podo</label>
                </div>
              </div>

              <!-- ðŸ”¹ Upholstery -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_upholstery_jadi">
                  <label class="form-check-label fw-semibold">upholstery_jadi</label>
                </div>
                <div class="text-center border rounded p-2 bg-light">
                  <a id="linkUpholstery" href="#" target="_blank" style="display:none;">
                    <img id="imgUpholstery" src="" class="img-fluid rounded shadow-sm"
                      style="max-width:150px; border:1px solid #ccc;">
                  </a>
                </div>
              </div>

              <!-- ðŸ”¹ Approval Produk Jadi -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_approval_produkjadi">
                  <label class="form-check-label fw-semibold">approval_produkjadi</label>
                </div>
              </div>

              <!-- ðŸ”¹ Packde Kirim Bahan -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_packde_kirimbahan">
                  <label class="form-check-label fw-semibold">packde_kirimbahan</label>
                </div>
                <div class="text-center border rounded p-2 bg-light">
                  <a id="linkPackdeKirimbahan" href="#" target="_blank" style="display:none;">
                    <img id="imgPackdeKirimbahan" src="" class="img-fluid rounded shadow-sm"
                      style="max-width:150px; border:1px solid #ccc;">
                  </a>
                </div>
              </div>

              <!-- ðŸ”¹ Packde Ambil -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_packde_ambil">
                  <label class="form-check-label fw-semibold">packde_ambil</label>
                </div>
                <div class="text-center border rounded p-2 bg-light">
                  <a id="linkPackdeAmbil" href="#" target="_blank" style="display:none;">
                    <img id="imgPackdeAmbil" src="" class="img-fluid rounded shadow-sm"
                      style="max-width:150px; border:1px solid #ccc;">
                  </a>
                </div>
              </div>

              <!-- ðŸ”¹ Packde QC -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_packde_qc">
                  <label class="form-check-label fw-semibold">packde_qc</label>
                </div>
                <div class="text-center border rounded p-2 bg-light">
                  <a id="linkPackdeQC" href="#" target="_blank" style="display:none;">
                    <img id="imgPackdeQC" src="" class="img-fluid rounded shadow-sm"
                      style="max-width:150px; border:1px solid #ccc;">
                  </a>
                </div>
              </div>

              <!-- ðŸ”¹ Pickup Driver -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_pickup_driver">
                  <label class="form-check-label fw-semibold">pickup_driver</label>
                </div>
                <div class="text-center border rounded p-2 bg-light">
                  <a id="linkPickupDriver" href="#" target="_blank" style="display:none;">
                    <img id="imgPickupDriver" src="" class="img-fluid rounded shadow-sm"
                      style="max-width:150px; border:1px solid #ccc;">
                  </a>
                </div>
              </div>

              <!-- ðŸ”¹ Diterima Konsumen -->
              <div class="col-md-6 col-lg-4">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="flag_diterima_konsumen">
                  <label class="form-check-label fw-semibold">diterima_konsumen</label>
                </div>
                <div class="text-center border rounded p-2 bg-light">
                  <a id="linkDiterimaKonsumen" href="#" target="_blank" style="display:none;">
                    <img id="imgDiterimaKonsumen" src="" class="img-fluid rounded shadow-sm"
                      style="max-width:150px; border:1px solid #ccc;">
                  </a>
                </div>
              </div>
            </div>
          </div>


          <!-- ===== TAB PRODUKSI & GAMBAR ===== -->
          <div class="tab-pane fade" id="tab-prod" role="tabpanel">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label fw-semibold">code1</label>
                <input type="text" class="form-control" id="editCode1" readonly disabled />
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">code2</label>
                <input type="text" class="form-control" id="editCode2" readonly disabled />
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">websiteornot</label>
                <input type="text" class="form-control" id="editWebsiteOrNot" />
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Foto Produksi (klik untuk buka)</label>
                <div class="d-flex flex-wrap gap-3 mt-2">
                  <a href="#" target="_blank" id="linkPackdeKirimbahan"><img id="imgPackdeKirimbahan"
                      class="border rounded" style="max-width:160px; max-height:120px;"></a>
                  <a href="#" target="_blank" id="linkUpholstery"><img id="imgUpholstery" class="border rounded"
                      style="max-width:160px; max-height:120px;"></a>
                  <a href="#" target="_blank" id="linkPackdeAmbil"><img id="imgPackdeAmbil" class="border rounded"
                      style="max-width:160px; max-height:120px;"></a>
                  <a href="#" target="_blank" id="linkPackdeQC"><img id="imgPackdeQC" class="border rounded"
                      style="max-width:160px; max-height:120px;"></a>
                  <a href="#" target="_blank" id="linkRejectAmbil"><img id="imgRejectAmbil" class="border rounded"
                      style="max-width:160px; max-height:120px;"></a>
                  <a href="#" target="_blank" id="linkPickupDriver"><img id="imgPickupDriver" class="border rounded"
                      style="max-width:160px; max-height:120px;"></a>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== TAB EXTRACHARGE ===== -->
          <div class="tab-pane fade" id="tab-extra" role="tabpanel">
            <div class="table-responsive">
              <table class="table table-sm table-bordered" id="tableExtraChargeFull">
                <thead class="table-light">
                  <tr>
                    <th>No</th>
                    <th>Charge Item</th>
                    <th>Qty</th>
                    <th>Price</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <td colspan="3" class="text-end fw-semibold">Total</td>
                    <td id="extraChargeTotal">Rp 0</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- ===== TAB HISTORY (Inline CRUD + Draggable) ===== -->
          <div class="tab-pane fade show" id="tab-history" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="fw-semibold mb-0"><i class="bi bi-clock-history me-2"></i>Riwayat Transaksi</h6>
              <div>
                <button class="btn btn-sm btn-success" id="btnAddRow"><i class="bi bi-plus-lg"></i> Tambah</button>
                <button class="btn btn-sm btn-secondary" id="btnFormatJSON"><i class="bi bi-arrow-repeat"></i> Refresh
                  JSON</button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-sm table-bordered align-middle text-nowrap" id="tableHistoryInline">
                <thead class="table-light">
                  <tr>
                    <th style="width:35px;"></th>
                    <th>Tanggal</th>
                    <th>User</th>
                    <th>Username</th>
                    <th>Tindakan</th>
                    <th>Status</th>
                    <th>Keterangan</th>
                    <th>Lampiran</th>
                    <th style="width:100px;">Aksi</th>
                  </tr>
                </thead>
                <tbody id="tbodyHistoryInline"></tbody>
              </table>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="fw-semibold mb-0"><i class="bi bi-clock-history me-2"></i>JSON Mentah</h6>
            </div>
            <textarea id="editHistoryJSON" class="form-control font-monospace small mt-2" rows="10"
              style="white-space: pre; background:#f8f9fa;"></textarea>
            <div class="form-text small text-muted">
              Format otomatis tersimpan dalam JSON di atas. Disinkronkan otomatis ke server saat klik <b>Save
                Changes</b>.
            </div>
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <small class="text-muted me-auto">Semua field bisa diedit â€” perubahan akan dikirim ke server.</small>
        <button type="button" class="btn btn-light border" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveEditDetail">Save Changes</button>
      </div>
    </div>
  </div>
</div>



<!-- =======================
ðŸ•“ Modal Edit History
======================= -->
<div class="modal fade" id="modalEditHistory" tabindex="-1" aria-labelledby="modalEditHistoryLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title fw-semibold" id="modalEditHistoryLabel">
          <i class="bi bi-code-square me-2 text-secondary"></i> Edit History (JSON)
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="alert alert-info small mb-3">
          <i class="bi bi-info-circle me-1"></i> Edit JSON riwayat transaksi di bawah ini. Pastikan formatnya valid.
        </div>

        <textarea id="editHistoryJson" class="form-control font-monospace" rows="15"
          style="resize: vertical; background-color: #f8f9fa;"></textarea>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-light border" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" id="saveEditHistory">Save JSON</button>
      </div>
    </div>
  </div>
</div>